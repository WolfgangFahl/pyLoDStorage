

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>tests.testSqlite3 &mdash; pyLoDStorage  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> pyLoDStorage
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sampledata.html">sampledata package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../setup.html">setup module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tests.html">tests package</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyLoDStorage</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>tests.testSqlite3</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tests.testSqlite3</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Created on 2020-08-24</span>

<span class="sd">@author: wf</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">from</span> <span class="nn">tests.basetest</span> <span class="kn">import</span> <span class="n">Basetest</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">lodstorage.sample</span> <span class="kn">import</span> <span class="n">Sample</span>
<span class="kn">from</span> <span class="nn">lodstorage.uml</span> <span class="kn">import</span> <span class="n">UML</span>
<span class="kn">from</span> <span class="nn">lodstorage.schema</span> <span class="kn">import</span> <span class="n">Schema</span>
<span class="kn">from</span> <span class="nn">lodstorage.sql</span> <span class="kn">import</span> <span class="n">SQLDB</span><span class="p">,</span> <span class="n">EntityInfo</span>


<div class="viewcode-block" id="TestSQLDB"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB">[docs]</a><span class="k">class</span> <span class="nc">TestSQLDB</span><span class="p">(</span><span class="n">Basetest</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test the SQLDB database wrapper</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
<div class="viewcode-block" id="TestSQLDB.checkListOfRecords"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.checkListOfRecords">[docs]</a>    <span class="k">def</span> <span class="nf">checkListOfRecords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">listOfRecords</span><span class="p">,</span><span class="n">entityName</span><span class="p">,</span><span class="n">primaryKey</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">executeMany</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">fixNone</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fixDates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">doClose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        check the handling of the given list of Records</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">          </span>
<span class="sd">           listOfRecords(list): a list of dicts that contain the data to be stored</span>
<span class="sd">           entityName(string): the name of the entity type to be used as a table name</span>
<span class="sd">           primaryKey(string): the name of the key / column to be used as a primary key</span>
<span class="sd">           executeMany(boolean): True if executeMany mode of sqlite3 should be used</span>
<span class="sd">           fixNone(boolean): fix dict entries that are undefined to have a &quot;None&quot; entry</span>
<span class="sd">           debug(boolean): True if debug information e.g. CREATE TABLE and INSERT INTO commands should be shown</span>
<span class="sd">           doClose(boolean): True if the connection should be closed</span>
<span class="sd">      </span>
<span class="sd">        &#39;&#39;&#39;</span>     
        <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> size is </span><span class="si">%d</span><span class="s2"> fixNone is </span><span class="si">%r</span><span class="s2"> fixDates is: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entityName</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="n">fixNone</span><span class="p">,</span><span class="n">fixDates</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">=</span><span class="n">SQLDB</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span><span class="n">errorDebug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">entityInfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">createTable</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span><span class="n">entityName</span><span class="p">,</span><span class="n">primaryKey</span><span class="p">)</span>
        <span class="n">startTime</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">,</span><span class="n">entityInfo</span><span class="p">,</span><span class="n">executeMany</span><span class="o">=</span><span class="n">executeMany</span><span class="p">,</span><span class="n">fixNone</span><span class="o">=</span><span class="n">fixNone</span><span class="p">)</span>
        <span class="n">elapsed</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">startTime</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;adding </span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> records took </span><span class="si">%5.3f</span><span class="s2"> s =&gt; %5.f records/s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">entityName</span><span class="p">,</span><span class="n">elapsed</span><span class="p">,</span><span class="n">size</span><span class="o">/</span><span class="n">elapsed</span><span class="p">))</span> 
        <span class="n">resultList</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">queryAll</span><span class="p">(</span><span class="n">entityInfo</span><span class="p">,</span><span class="n">fixDates</span><span class="o">=</span><span class="n">fixDates</span><span class="p">)</span>    
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;selecting </span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> records took </span><span class="si">%5.3f</span><span class="s2"> s =&gt; %5.f records/s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resultList</span><span class="p">),</span><span class="n">entityName</span><span class="p">,</span><span class="n">elapsed</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">resultList</span><span class="p">)</span><span class="o">/</span><span class="n">elapsed</span><span class="p">))</span> 
        <span class="k">if</span> <span class="n">doClose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">resultList</span></div>
    
<div class="viewcode-block" id="TestSQLDB.testEntityInfo"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.testEntityInfo">[docs]</a>    <span class="k">def</span> <span class="nf">testEntityInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        test creating entityInfo from the sample record</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">listOfRecords</span><span class="o">=</span><span class="n">Sample</span><span class="o">.</span><span class="n">getRoyals</span><span class="p">()</span>
        <span class="n">entityInfo</span><span class="o">=</span><span class="n">EntityInfo</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;Person&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE Person(name TEXT PRIMARY KEY,born DATE,numberInLine INTEGER,wikidataurl TEXT,age FLOAT,ofAge BOOLEAN,lastmodified TIMESTAMP)&quot;</span><span class="p">,</span><span class="n">entityInfo</span><span class="o">.</span><span class="n">createTableCmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;INSERT INTO Person (name,born,numberInLine,wikidataurl,age,ofAge,lastmodified) values (:name,:born,:numberInLine,:wikidataurl,:age,:ofAge,:lastmodified)&quot;</span><span class="p">,</span><span class="n">entityInfo</span><span class="o">.</span><span class="n">insertCmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">=</span><span class="n">SQLDB</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span><span class="n">errorDebug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">entityInfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">createTable</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span><span class="n">entityInfo</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">entityInfo</span><span class="o">.</span><span class="n">primaryKey</span><span class="p">)</span>
        <span class="n">tableList</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">getTableList</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="n">tableList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tableList</span><span class="p">))</span>
        <span class="n">personTable</span><span class="o">=</span><span class="n">tableList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;Person&quot;</span><span class="p">,</span><span class="n">personTable</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">personTable</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">]))</span>
        <span class="n">uml</span><span class="o">=</span><span class="n">UML</span><span class="p">()</span>
        <span class="n">plantUml</span><span class="o">=</span><span class="n">uml</span><span class="o">.</span><span class="n">tableListToPlantUml</span><span class="p">(</span><span class="n">tableList</span><span class="p">,</span><span class="n">packageName</span><span class="o">=</span><span class="s2">&quot;Royals&quot;</span><span class="p">,</span><span class="n">withSkin</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">plantUml</span><span class="p">)</span>
        <span class="n">expected</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;package Royals {</span>
<span class="s2">  class Person &lt;&lt; Entity &gt;&gt; {</span>
<span class="s2">   age : FLOAT </span>
<span class="s2">   born : DATE </span>
<span class="s2">   lastmodified : TIMESTAMP </span>
<span class="s2">   name : TEXT &lt;&lt;PK&gt;&gt;</span>
<span class="s2">   numberInLine : INTEGER </span>
<span class="s2">   ofAge : BOOLEAN </span>
<span class="s2">   wikidataurl : TEXT </span>
<span class="s2">  }</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span><span class="n">plantUml</span><span class="p">)</span>
        
        <span class="c1"># testGeneralization</span>
        <span class="n">listOfRecords</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Royal family&#39;</span><span class="p">,</span> <span class="s1">&#39;country&#39;</span><span class="p">:</span> <span class="s1">&#39;UK&#39;</span><span class="p">,</span> <span class="s1">&#39;lastmodified&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()}]</span>
        <span class="n">entityInfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">createTable</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;Family&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
        <span class="n">tableList</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">getTableList</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tableList</span><span class="p">))</span>
        <span class="n">uml</span><span class="o">=</span><span class="n">UML</span><span class="p">()</span>
        <span class="n">plantUml</span><span class="o">=</span><span class="n">uml</span><span class="o">.</span><span class="n">tableListToPlantUml</span><span class="p">(</span><span class="n">tableList</span><span class="p">,</span><span class="n">generalizeTo</span><span class="o">=</span><span class="s2">&quot;PersonBase&quot;</span><span class="p">,</span><span class="n">withSkin</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">plantUml</span><span class="p">)</span>
        <span class="n">expected</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;class PersonBase &lt;&lt; Entity &gt;&gt; {</span>
<span class="s1"> lastmodified : TIMESTAMP </span>
<span class="s1"> name : TEXT &lt;&lt;PK&gt;&gt;</span>
<span class="s1">}</span>
<span class="s1">class Person &lt;&lt; Entity &gt;&gt; {</span>
<span class="s1"> age : FLOAT </span>
<span class="s1"> born : DATE </span>
<span class="s1"> numberInLine : INTEGER </span>
<span class="s1"> ofAge : BOOLEAN </span>
<span class="s1"> wikidataurl : TEXT </span>
<span class="s1">}</span>
<span class="s1">class Family &lt;&lt; Entity &gt;&gt; {</span>
<span class="s1"> country : TEXT </span>
<span class="s1">}</span>
<span class="s1">PersonBase &lt;|-- Person</span>
<span class="s1">PersonBase &lt;|-- Family</span>
<span class="s1">&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span><span class="n">plantUml</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="TestSQLDB.testIssue15"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.testIssue15">[docs]</a>    <span class="k">def</span> <span class="nf">testIssue15</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        https://github.com/WolfgangFahl/pyLoDStorage/issues/15</span>
<span class="sd">        </span>
<span class="sd">        auto create view ddl in mergeschema</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">=</span><span class="n">SQLDB</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span><span class="n">errorDebug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
        <span class="n">listOfRecords</span><span class="o">=</span><span class="n">Sample</span><span class="o">.</span><span class="n">getRoyals</span><span class="p">()</span>
        <span class="n">entityInfo</span><span class="o">=</span><span class="n">EntityInfo</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;Person&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
        <span class="n">entityInfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">createTable</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span><span class="n">entityInfo</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">entityInfo</span><span class="o">.</span><span class="n">primaryKey</span><span class="p">)</span>
        <span class="n">listOfRecords</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Royal family&#39;</span><span class="p">,</span> <span class="s1">&#39;country&#39;</span><span class="p">:</span> <span class="s1">&#39;UK&#39;</span><span class="p">,</span> <span class="s1">&#39;lastmodified&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()}]</span>
        <span class="n">entityInfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">createTable</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;Family&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
        <span class="n">tableList</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">getTableList</span><span class="p">()</span>
        <span class="n">viewDDL</span><span class="o">=</span><span class="n">Schema</span><span class="o">.</span><span class="n">getGeneralViewDDL</span><span class="p">(</span><span class="n">tableList</span><span class="p">,</span><span class="s2">&quot;PersonBase&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="n">viewDDL</span><span class="p">)</span>
        <span class="n">expected</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;CREATE VIEW PersonBase AS </span>
<span class="s2">  SELECT name,lastmodified FROM Person</span>
<span class="s2">UNION</span>
<span class="s2">  SELECT name,lastmodified FROM Family&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span><span class="n">viewDDL</span><span class="p">)</span>
        <span class="k">pass</span></div>
        
<div class="viewcode-block" id="TestSQLDB.testUniqueConstraint"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.testUniqueConstraint">[docs]</a>    <span class="k">def</span> <span class="nf">testUniqueConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        test for https://github.com/WolfgangFahl/pyLoDStorage/issues/4</span>
<span class="sd">        sqlite3.IntegrityError: UNIQUE constraint failed: ... show debug info</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">listOfDicts</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Frank Doe&quot;</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Tim Doe&quot;</span><span class="p">}]</span>
        <span class="n">sqlDB</span><span class="o">=</span><span class="n">SQLDB</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span><span class="n">errorDebug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">entityInfo</span><span class="o">=</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">createTable</span><span class="p">(</span><span class="n">listOfDicts</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;Does&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sqlDB</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">listOfDicts</span><span class="p">,</span><span class="n">entityInfo</span><span class="p">,</span><span class="n">executeMany</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;There should be an exception&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">expected</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;INSERT INTO Does (name) values (:name)</span>
<span class="s2">failed:UNIQUE constraint failed: Does.name</span>
<span class="s2">record  #3={&#39;name&#39;: &#39;John Doe&#39;}&quot;&quot;&quot;</span>
            <span class="n">errMsg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span><span class="n">errMsg</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="TestSQLDB.testSqlite3"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.testSqlite3">[docs]</a>    <span class="k">def</span> <span class="nf">testSqlite3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        test sqlite3 with a few records from the royal family</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">listOfRecords</span><span class="o">=</span><span class="n">Sample</span><span class="o">.</span><span class="n">getRoyals</span><span class="p">()</span>
        <span class="n">resultList</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">checkListOfRecords</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">,</span> <span class="s1">&#39;Person&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">resultList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">,</span><span class="n">resultList</span><span class="p">)</span></div>
       
<div class="viewcode-block" id="TestSQLDB.testIssue13_setNoneValue"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.testIssue13_setNoneValue">[docs]</a>    <span class="k">def</span> <span class="nf">testIssue13_setNoneValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        https://github.com/WolfgangFahl/pyLoDStorage/issues/13</span>
<span class="sd">        set None value for undefined LoD entries</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">listOfRecords</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span> <span class="s1">&#39;make&#39;</span><span class="p">:</span> <span class="s1">&#39;Ford&#39;</span><span class="p">,</span><span class="s1">&#39;model&#39;</span><span class="p">:</span><span class="s1">&#39;Model T&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">},</span>
            <span class="p">{</span> <span class="s1">&#39;make&#39;</span><span class="p">:</span> <span class="s1">&#39;VW&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span><span class="s1">&#39;beetle&#39;</span><span class="p">}</span>
        <span class="p">]</span>
        <span class="n">entityName</span><span class="o">=</span><span class="s2">&quot;Car&quot;</span>
        <span class="n">primaryKey</span><span class="o">=</span><span class="s2">&quot;Model&quot;</span>
        <span class="n">resultList</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">checkListOfRecords</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">,</span> <span class="n">entityName</span><span class="p">,</span> <span class="n">primaryKey</span><span class="p">,</span><span class="n">fixNone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="n">resultList</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="TestSQLDB.testIssue14_execute"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.testIssue14_execute">[docs]</a>    <span class="k">def</span> <span class="nf">testIssue14_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        https://github.com/WolfgangFahl/pyLoDStorage/issues/14</span>
<span class="sd">        </span>
<span class="sd">        offer execute wrapper directly via sqlDB</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">sqlDB</span><span class="o">=</span><span class="n">SQLDB</span><span class="p">()</span>
        <span class="n">ddl</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        CREATE TABLE contacts (</span>
<span class="s2">            contact_id INTEGER PRIMARY KEY,</span>
<span class="s2">            first_name TEXT NOT NULL,</span>
<span class="s2">            last_name TEXT NOT NULL</span>
<span class="s2">        )</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">sqlDB</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">ddl</span><span class="p">)</span>
        <span class="n">tableList</span><span class="o">=</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">getTableList</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">tableList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tableList</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;contacts&quot;</span><span class="p">,</span><span class="n">tableList</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span></div>
        
<div class="viewcode-block" id="TestSQLDB.testIssue41"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.testIssue41">[docs]</a>    <span class="k">def</span> <span class="nf">testIssue41</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        https://github.com/WolfgangFahl/pyLoDStorage/issues/41</span>
<span class="sd">        improve error message when create table command fails</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">listOfRecords</span><span class="o">=</span><span class="p">[{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;py/object&#39;</span><span class="p">:</span> <span class="s1">&#39;datetime.time&#39;</span>
        <span class="p">}]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">=</span><span class="n">SQLDB</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span><span class="n">errorDebug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_entityInfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">createTable</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;Invalid&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;There should be an exception&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE Invalid&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span></div>
         
<div class="viewcode-block" id="TestSQLDB.testBindingError"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.testBindingError">[docs]</a>    <span class="k">def</span> <span class="nf">testBindingError</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        test list of Records with incomplete record leading to</span>
<span class="sd">        &quot;You did not supply a value for binding 2&quot;</span>
<span class="sd">        see https://bugs.python.org/issue41638</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">listOfRecords</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;Pikachu&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Electric&#39;</span><span class="p">},{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;Raichu&#39;</span> <span class="p">}]</span>
        <span class="k">for</span> <span class="n">executeMany</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">checkListOfRecords</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">,</span><span class="s1">&#39;Pokemon&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="n">executeMany</span><span class="o">=</span><span class="n">executeMany</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;There should be an exception&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s1">&#39;no value supplied for column&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>                                                         </div>
        
<div class="viewcode-block" id="TestSQLDB.testListOfCities"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.testListOfCities">[docs]</a>    <span class="k">def</span> <span class="nf">testListOfCities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        test sqlite3 with some 120000 city records</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">listOfRecords</span><span class="o">=</span><span class="n">Sample</span><span class="o">.</span><span class="n">getCities</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fixDates</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">]:</span>
            <span class="n">retrievedList</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">checkListOfRecords</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">,</span><span class="s1">&#39;City&#39;</span><span class="p">,</span><span class="n">fixDates</span><span class="o">=</span><span class="n">fixDates</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">retrievedList</span><span class="p">))</span></div>
            
<div class="viewcode-block" id="TestSQLDB.testQueryParams"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.testQueryParams">[docs]</a>    <span class="k">def</span> <span class="nf">testQueryParams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        test Query Params</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">listOfDicts</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="s2">&quot;New York&quot;</span><span class="p">,</span> <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;US&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="s2">&quot;Amsterdam&quot;</span><span class="p">,</span> <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;NL&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="s2">&quot;Paris&quot;</span><span class="p">,</span> <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;FR&quot;</span><span class="p">}]</span>
        <span class="n">sqlDB</span><span class="o">=</span><span class="n">SQLDB</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span><span class="n">errorDebug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">entityInfo</span><span class="o">=</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">createTable</span><span class="p">(</span><span class="n">listOfDicts</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;cities&#39;</span><span class="p">,</span><span class="s1">&#39;city&#39;</span><span class="p">)</span>
        <span class="n">sqlDB</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">listOfDicts</span><span class="p">,</span><span class="n">entityInfo</span><span class="p">,</span><span class="n">executeMany</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;SELECT * from cities WHERE country in (?)&quot;</span>
        <span class="n">params</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;FR&#39;</span><span class="p">,)</span>
        <span class="n">frCities</span><span class="o">=</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="n">frCities</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([{</span><span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;Paris&#39;</span><span class="p">,</span> <span class="s1">&#39;country&#39;</span><span class="p">:</span> <span class="s1">&#39;FR&#39;</span><span class="p">}],</span><span class="n">frCities</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="TestSQLDB.testSqllite3Speed"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.testSqllite3Speed">[docs]</a>    <span class="k">def</span> <span class="nf">testSqllite3Speed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        test sqlite3 speed with some 100000 artificial sample records</span>
<span class="sd">        consisting of two columns with a running index</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">limit</span><span class="o">=</span><span class="mi">100000</span>
        <span class="n">listOfRecords</span><span class="o">=</span><span class="n">Sample</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkListOfRecords</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">,</span> <span class="s1">&#39;Sample&#39;</span><span class="p">,</span> <span class="s1">&#39;pKey&#39;</span><span class="p">)</span>  </div>
        
<div class="viewcode-block" id="TestSQLDB.testIssue87AllowUsingQueryWithGenerator"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.testIssue87AllowUsingQueryWithGenerator">[docs]</a>    <span class="k">def</span> <span class="nf">testIssue87AllowUsingQueryWithGenerator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        test the query gen approach</span>
<span class="sd">        &#39;&#39;&#39;</span>   
        <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span>
        <span class="c1">#debug=True</span>
        <span class="n">sqlDB</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getSampleTableDB</span><span class="p">(</span><span class="n">sampleSize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">sqlQuery</span><span class="o">=</span><span class="s2">&quot;select * FROM sample&quot;</span>
        <span class="k">for</span> <span class="n">cindex</span><span class="p">,</span><span class="n">record</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">queryGen</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cindex</span><span class="p">,</span><span class="n">record</span><span class="p">[</span><span class="s2">&quot;cindex&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSQLDB.testBackup"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.testBackup">[docs]</a>    <span class="k">def</span> <span class="nf">testBackup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        test creating a backup of the SQL database</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
            <span class="n">listOfRecords</span><span class="o">=</span><span class="n">Sample</span><span class="o">.</span><span class="n">getCities</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkListOfRecords</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">,</span><span class="s1">&#39;City&#39;</span><span class="p">,</span><span class="n">fixDates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">doClose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">backupDB</span><span class="o">=</span><span class="s2">&quot;/tmp/testSqlite.db&quot;</span>
            <span class="n">showProgress</span><span class="o">=</span><span class="mi">200</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">backupDB</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span><span class="n">showProgress</span><span class="o">=</span><span class="n">showProgress</span><span class="p">)</span>
            <span class="n">size</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">backupDB</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;size of backup DB is </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">size</span><span class="o">&gt;</span><span class="mi">600000</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c1"># restore</span>
            <span class="n">ramDB</span><span class="o">=</span><span class="n">SQLDB</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">backupDB</span><span class="p">,</span> <span class="n">SQLDB</span><span class="o">.</span><span class="n">RAM</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span><span class="n">showProgress</span><span class="o">=</span><span class="n">showProgress</span><span class="p">)</span>
            <span class="n">entityInfo</span><span class="o">=</span><span class="n">EntityInfo</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">[:</span><span class="mi">50</span><span class="p">],</span><span class="s1">&#39;City&#39;</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
            <span class="n">allCities</span><span class="o">=</span><span class="n">ramDB</span><span class="o">.</span><span class="n">queryAll</span><span class="p">(</span><span class="n">entityInfo</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">allCities</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">))</span></div>
            
<div class="viewcode-block" id="TestSQLDB.testCopy"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.testCopy">[docs]</a>    <span class="k">def</span> <span class="nf">testCopy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        test copying databases into another database</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">dbFile</span><span class="o">=</span><span class="s2">&quot;/tmp/DAWT_Sample3x1000.db&quot;</span>
        <span class="n">copyDB</span><span class="o">=</span><span class="n">SQLDB</span><span class="p">(</span><span class="n">dbFile</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sampleNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">listOfRecords</span><span class="o">=</span><span class="n">Sample</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkListOfRecords</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">,</span> <span class="s1">&#39;Sample_</span><span class="si">%d</span><span class="s1">_1000&#39;</span> <span class="o">%</span><span class="n">sampleNo</span><span class="p">,</span> <span class="s1">&#39;pKey&#39;</span><span class="p">,</span><span class="n">doClose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">copyDB</span><span class="p">)</span>
        <span class="n">size</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">dbFile</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;size of copy DB is </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">size</span><span class="o">&gt;</span><span class="mi">70000</span><span class="p">)</span>
        <span class="n">tableList</span><span class="o">=</span><span class="n">copyDB</span><span class="o">.</span><span class="n">getTableList</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">tableList</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sampleNo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s1">&#39;Sample_</span><span class="si">%d</span><span class="s1">_1000&#39;</span> <span class="o">%</span><span class="n">sampleNo</span><span class="p">,</span><span class="n">tableList</span><span class="p">[</span><span class="n">sampleNo</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="c1"># check that database is writable</span>
        <span class="c1"># https://stackoverflow.com/a/44707371/1497139</span>
        <span class="n">copyDB</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;pragma user_version=0&quot;</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="TestSQLDB.getSampleTableDB"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.getSampleTableDB">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">getSampleTableDB</span><span class="p">(</span><span class="n">withDrop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">failIfTooFew</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sampleSize</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">listOfRecords</span><span class="o">=</span><span class="n">Sample</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">sampleSize</span><span class="p">)</span>
        <span class="n">sqlDB</span><span class="o">=</span><span class="n">SQLDB</span><span class="p">()</span>
        <span class="n">entityName</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span>
        <span class="n">primaryKey</span><span class="o">=</span><span class="s1">&#39;pKey&#39;</span>
        <span class="n">sampleRecordCount</span><span class="o">=</span><span class="n">sampleSize</span><span class="o">*</span><span class="mi">10</span>
        <span class="n">sqlDB</span><span class="o">.</span><span class="n">debug</span><span class="o">=</span><span class="n">debug</span>
        <span class="n">entityInfo</span><span class="o">=</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">createTable</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">,</span> <span class="n">entityName</span><span class="p">,</span> <span class="n">primaryKey</span><span class="o">=</span><span class="n">primaryKey</span><span class="p">,</span> <span class="n">withDrop</span><span class="o">=</span><span class="n">withDrop</span><span class="p">,</span> <span class="n">sampleRecordCount</span><span class="o">=</span><span class="n">sampleRecordCount</span><span class="p">,</span><span class="n">failIfTooFew</span><span class="o">=</span><span class="n">failIfTooFew</span><span class="p">)</span>
        <span class="n">executeMany</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">fixNone</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">sqlDB</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">listOfRecords</span><span class="p">,</span><span class="n">entityInfo</span><span class="p">,</span><span class="n">executeMany</span><span class="o">=</span><span class="n">executeMany</span><span class="p">,</span><span class="n">fixNone</span><span class="o">=</span><span class="n">fixNone</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sqlDB</span></div>
        
<div class="viewcode-block" id="TestSQLDB.testIssue16"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.testIssue16">[docs]</a>    <span class="k">def</span> <span class="nf">testIssue16</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        https://github.com/WolfgangFahl/pyLoDStorage/issues/16</span>
<span class="sd">        allow to only warn if samplerecordcount is higher than number of available records</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getSampleTableDB</span><span class="p">(</span><span class="n">withDrop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">failIfTooFew</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getSampleTableDB</span><span class="p">(</span><span class="n">withDrop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">failIfTooFew</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;There should be an exception that too few sample records where provided&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;only 1000/10000 of needed sample records to createTable available&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span></div>
        
<div class="viewcode-block" id="TestSQLDB.testIssue18"><a class="viewcode-back" href="../../tests.html#tests.testSqlite3.TestSQLDB.testIssue18">[docs]</a>    <span class="k">def</span> <span class="nf">testIssue18</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        https://github.com/WolfgangFahl/pyLoDStorage/issues/18</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">sqlDB</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getSampleTableDB</span><span class="p">()</span>
        <span class="n">tableDict</span><span class="o">=</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">getTableDict</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="n">tableDict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;sample&quot;</span> <span class="ow">in</span> <span class="n">tableDict</span><span class="p">)</span>
        <span class="n">cols</span><span class="o">=</span><span class="n">tableDict</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">][</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;pkey&quot;</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">)</span></div></div>
       
        
        
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1">#import sys;sys.argv = [&#39;&#39;, &#39;Test.testSqllit3&#39;]</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020-2021, Wolfgang Fahl.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>